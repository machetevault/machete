<!DOCTYPE html>
<html lang="en-US">
<head>
<link rel="icon" type="image/x-icon" href="/conf/LOGO01.png">
<link rel="stylesheet" type="text/css" href="/conf/machete_style_offensive_sections.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="/conf/machete_conf.js"></script>
	
  <title> M A C H E T E </title>
  <!--------------------->
  <!-- b0ydC Founder -->
  <!-- --------------- -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8" />

</head>
<body>
<br>
<a href="/index.html"><img src="/conf/letter_logo.jpg" alt="LOGO" style="width:20%;"></a>
<br>
<center>
<div style="font-size:24px; text-align:center; font-family:courier,monospace;">
    <a href="/offensive.html">OFFENSIVE</a> |
    <a href="/defensive.html">DEFENSIVE</a> |
    <a href="/tools.html">WIKI</a> |
    <a href="/wiki/academy.html">ACADEMY</a> |
    <a href="/about.html">ABOUT</a> 
</div> 

<p class="titulos"><mark>[CROSS-SITE REQUEST FORGERY]</mark></p>
<div>
<pre>
<div class="column" style="display: inline-block; text-align: left; background-color:gray;">
<button onclick="document.location='/offensive/web_penetration_testing/client_side_attacks.html'" class="round" style="float: left;">&lt;&lt;</button><br><br>
<details>
<summary>GENERAL INFORMATION</summary>
<b><u>3 METHOD QUESTION:</u></b>

1. A relevant action?
2. Cookie based session handling?
3. No unpredictable request parameters = CSRF Token?

*******
	
1. First thing, activity needs to be from authenticated actions. 
2. Check if the <u>CSRF token is present.</u> [inspect the headers / burpsuite]
3. If no token is present, a CSRF PoC can be used. [burpsuite PRO / manual way]
	
<b>Burpsuite:</b> On RAW request > right click > engagement tools > generate CSRF PoC

NOTE: user interaction is required at some point.
NOTE: inspect the code is vital, so you can use the form HTML code to prepare your CSRF PoC. with burpsuite PRO
it will be easy. 

Diferent payloads can be used. HTML tags

&lt;img src="https://vulnerable-website.com/email/change?email=pwned@evil-user.net"&gt;
		
</details>
<details>
<summary>TOKEN TECHNIQUES</summary>
<b>DESCRIPTION: </b>Collection of techniques used to test the different tokens we can find, CSRF tokens and more.

1. Inspect the source code of the page and look for any kind of token associated to the action.
For example, maybe a form with a csrf token. 

<b>SAMPLE:</b> 	

&lt;input type="text" name="csrf" id="csrf" value="rt6A7TkfcGHMUc" hidden&gt;

2. It is important to test if the specific token provided is validated or if it is only validating that the field exists. 
In other words, is this validating the key value or format? 
3. Are you able to attempt XSS ?

</details>
<details>
<summary>BYPASS TECHNIQUES</summary>
	
	
</details>
<details>
<summary>PAYLOADS/EXPLOITS</summary>

<a href="https://github.com/machetevault/machete/blob/main/tools/csrf_exploits/CSRF_PoC_POST_sample.html" target="_blank">CSRF_PoC_POST_sample.html</a><br>
<a href="https://github.com/machetevault/machete/blob/main/tools/csrf_exploits/CSRF_PoC_onload_sample.html" target="_blank">CSRF_PoC_onload_sample.html</a>
<a href="https://github.com/machetevault/machete/blob/main/tools/csrf_exploits/csrf_python_server.html" target="_blank">CSRF_PoC_python_server.html</a><br>

	
</details>
<details>
<summary>TOKEN VALIDATION ON REQUEST METHOD</summary>
it is when the control applies defenses against certain types of requests. 

1. important to validate if the CSRF token is been validated or not. rejected or not ?
2. first test is to change request method and validate if the CSRF token is rejected or not.
3. burp profesional > right click > engagement tools > generate CSRF PoC
4. use the following code as sample, check source code to confirm the parameters needed for the action.
	
</details>
<details>
<summary>TOKEN VALIDATION ON BEING PRESENT</summary>
pretty important to validate,
1. without csrf token
2. changing method
3. validating GET requests y CSRF tokens
4. validating if the CSRF toke is being validated
	
</details>
<details>
<summary>BROKEN REFERER VALIDATION</summary>

</details>
<details>
<summary>NOT TIED TO USER SESSION</summary>
- several tests
	* csrf token is valid ?
	* csrf token is needed ?
	* csrf token is tied to session ? can you use one from other user session ?
	
</details>
<details>
<summary>TOKEN TIED TO NON-SESSION COOKIE</summary>
* important tests
	- repeat same tests 
	- important, is the csrf valid ?
	- exist the possibility to add input data to the cookie ?
	- if csrf cookie results in the CSRF token being rejected. This suggests that the csrfKey cookie may not be strictly 
	tied to the session.
	- it is important to get 2 users.

<b>NOTE:</b> important to read about possible ways to inject data in cookie headers. 

<b>SAMPLE:</b> Cookie: csrfToken=Vwd4uGdvuY9niiMD54K6WGaJWuLUCGbu; session=NyeAhFL0RXY89SGOuXMORNgCfuknGOaV; Search=hack

<b>NOTE:</b> Exist some different ways that can be used to trigger the alerts or inject payloads. one way is using SCRIPT HTML tag and
the other can be IMAGES. 

&lt;img src="https://machetevault.com/?search=hack%0d%0aSet-Cookie:%20csrfToken=YOUR-TOKEN%3b%20SameSite=None" onerror="document.forms[0].submit()"&gt;
	
</details>
<details>
<summary>TOKEN DUPLICATED IN COOKIE</summary>

</details>

</div>
</pre>
<button onclick="document.location='/offensive/web_penetration_testing/client_side_attacks.html'">GO BACK</button>
</div>
<p class="titulos">©® - 2023/2024.</p>
</center>
</body>
</html>

<!DOCTYPE html>
<html lang="en-US">
<head>
<link rel="icon" type="image/x-icon" href="/machete/conf/LOGO01.png">
<link rel="stylesheet" type="text/css" href="/machete/conf/machete_style_offensive_sections.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="/machete/conf/machete_conf.js"></script>
	
  <title> M A C H E T E </title>
  <!--------------------->
  <!-- b0ydC Founder -->
  <!-- --------------- -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8" />

</head>
<body>
<br>
<a href="/machete/index.html"><img src="/machete/conf/letter_logo.jpg" alt="LOGO" style="width:20%;"></a>
<br>
<center>
<div style="font-size:24px; text-align:center; font-family:courier,monospace;">
    <a href="/machete/offensive.html">OFFENSIVE</a> |
    <a href="/machete/defensive.html">DEFENSIVE</a> |
    <a href="/machete/tools.html">TOOLS</a> |
    <a href="/machete/about.html">ABOUT</a> 
</div> 
<p class="titulos"><mark>[CROSS-ORIGIN RESOURCE SHARING]</mark></p>
<div>
<pre>
<div class="column" style="display: inline-block; text-align: left; background-color:gray;">
<button onclick="document.location='/machete/offensive/web_penetration_testing/client_side_attacks.html'" class="round" style="float: left;">&lt;&lt;</button><br><br>
<details>
<summary>GENERAL INFO</summary>
<b>PRE-REQS:</b>
1. Authenticated session [if possible]
	
<b>NOTE:</b> When a request's credentials mode (request.credentials) is <b>include</b>, browsers will only expose the response to the 
frontend javascript code if the <b>Access-Control-Allow-Credentials</b> header value is TRUE.

<mark><b>::: ARBITRARY ORIGIN REFLECTION</b></mark>
	
<u><b>SAMPLE:</b></u>

&lt;script&gt;
fetch('/endpoint_to_exploit', {credentials:'include'}
&lt;/script&gt;
	
1. Manual inspection is needed to confirm this misconfiguration. [headers, code, etc]
2. If previous code sample is founded, CORS is possible to attempt.
3. Attempt to add the ORIGIN header. [burpsuite / repeater]
4. Check response, if header "Access-Control-Allow-Origin" is added it means CORS is used, attacks can be sucessful.

"HTTP/2 200 OK
Access-Control-Allow-Origin: https://machetevault.malicious.com"	
	
5. If headers <u>Access-Control-Allow-Credentials</u> and <u>Access-Control-Allow-Origin</u> are present, arbitrary <u>CORS</u>
can be accomplished.
6. User interaction is needed, so any way to send the payload to the user via social engineering is required.
	
<b><u>CHECK JS PAYLOAD:</u></b> | <a href="https://github.com/machetevault/machete/blob/main/tools/javascript/CORSexploit-origin-reflection.js" target="_blank">CORSexploit-origin-reflection.js</a> | <a href=" " target="_blank">DOWNLOAD</a>

<mark><b>::: NULL ORIGIN REFLECTION [trusted]</b></mark>

<u><b>NOTES:</b></u>
	
1. One way to distinguish between NULL and ARBITRARY CORS is to check if the header "Access-Control-Allow-Origin" is 
added to the response after adding any domain. <b>SAMPLE:</b> Access-Control-Allow-Origin: https://machete.malicious.com
2. If no header added, try null. <u>Origin: null</u> [burpsuite]
3. <b>Access-Control-Allow-Origin: null</b> will be added if successfull. 
4. It is needed to generate a null request, HTML <u>iframe sandbox</u> can be used. 

<b>CHECK JS PAYLOAD:</b> null origin | <a href="https://github.com/machetevault/machete/blob/main/tools/javascript/CORSexploit_null-origin.js" target="_blank">CORSexploit_null-origin.js</a> | <a href=" " target="_blank">DOWNLOAD</a>

<mark><b>::: ARBITRARY SUBDOMAIN ORIGIN REFLECTION [insecure-protocols]</b></mark>

<b>NOTES:</b> 
	
1. Same steps used for "ARBITRARY ORIGIN REFLECTION" can be applied, however, at the moment to test the origin header it is 
necessary first to try the same origin and after that, try it with the subdomain.
2. It is necessary to inspect the request to see if exist any request to other domain, subdomain, etc. that can be used as 
part of the attack.

<b>NOTE:</b> Sometimes this vulnerability is important when you have some kind of XSS as well that you can use to increase impact.

>>> Specific tests fror SUBDOMAIN reflection (besides previous ones)

<b>SAMPLE_DOMAIN:</b> http://domain.com

1. Change origin header to one that begins with current origin of the site.

<b>REFLECTED SAMPLE:</b> http://domain.com.malicious.site 	
	
2. Change origin header to one that ends with current origin of the site.

<b>REFLECTED SAMPLE:</b> http://malicious.site.domain.com	

<b>CHECK JS PAYLOAD:</b> | <a href="https://github.com/machetevault/machete/blob/main/tools/javascript/CORSexploit_origin-subdomainXSS.js" target="_blank">CORSexploit_origin-subdomainXSS.js</a> | <a href=" " target="_blank">DOWNLOAD</a>	
</details>

<b>ATTACKER LOCAL SERVER:</b> | <a href="https://github.com/machetevault/machete/blob/main/tools/bash/pyats.sh" target="_blank">pyats.sh</a>

</div>
</pre>
<button onclick="document.location='/machete/offensive/web_penetration_testing/client_side_attacks.html'">GO BACK</button>
</div>
<p class="titulos">©® - 2023.</p>
</center>
</body>
</html>

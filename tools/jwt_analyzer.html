<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JWT Analyzer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      line-height: 1.6;
      padding: 10px;
    }
    textarea, pre {
      width: 100%;
      margin-bottom: 18px;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 8px;
    }
    pre {
      background-color: #f8f8f8;
      overflow-x: auto;
    }
    button {
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 10px 15px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 15px;
    }
    button:hover {
      background-color: #0056b3;
    }
    h1, h2, h3 {
      color: #333;
      margin-bottom: 10px;
    }
    #editor {
      white-space: pre-wrap;
      background-color: #eef;
    }
    .flex-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>
  <script>
    function decodeToken() {
      const jwtInput = document.getElementById('jwtInput').value;
      try {
        const decodedHeader = jwt_decode(jwtInput, { header: true });
        const decodedPayload = jwt_decode(jwtInput);
        document.getElementById('headerEditor').textContent = JSON.stringify(decodedHeader, null, 4);
        document.getElementById('payloadEditor').textContent = JSON.stringify(decodedPayload, null, 4);
      } catch (error) {
        alert('Invalid JWT token!');
      }
    }

    function reencodeToken() {
      try {
        const editedHeader = JSON.parse(document.getElementById('headerEditor').textContent);
        const editedPayload = JSON.parse(document.getElementById('payloadEditor').textContent);

        const base64UrlEncode = (obj) => {
          return btoa(JSON.stringify(obj))
            .replace(/=/g, '')
            .replace(/\+/g, '-')
            .replace(/\//g, '_');
        };

        const encodedHeader = base64UrlEncode(editedHeader);
        const encodedPayload = base64UrlEncode(editedPayload);

        const newToken = `${encodedHeader}.${encodedPayload}.`;

        document.getElementById('newJwtOutput').textContent = newToken;
      } catch (error) {
        alert('Invalid JSON format!');
      }
    }

    function convertTimestampsToReadable() {
      const payloadEditor = document.getElementById('payloadEditor');
      try {
        const decodedPayload = JSON.parse(payloadEditor.textContent);
        const readablePayload = convertTimestamps(decodedPayload);
        payloadEditor.textContent = JSON.stringify(readablePayload, null, 4);
      } catch (error) {
        alert('Please decode the JWT first or ensure the payload is valid JSON!');
      }
    }

    function convertTimestamps(payload) {
      const keys = ['exp', 'iat', 'nbf'];
      for (const key of keys) {
        if (payload[key]) {
          payload[key] = {
            "timestamp": payload[key],
            "readable": new Date(payload[key] * 1000).toLocaleString(),
          };
        }
      }
      return payload;
    }

    function clearFields() {
      document.getElementById('jwtInput').value = '';
      document.getElementById('headerEditor').textContent = '';
      document.getElementById('payloadEditor').textContent = '';
      document.getElementById('newJwtOutput').textContent = '';
    }
  </script>
</head>
<body>
  <h1>JWT Analyzer</h1>
  <textarea id="jwtInput" placeholder="Enter your JWT token here" rows="3"></textarea>
  <div class="flex-container">
    <button onclick="decodeToken()" title="Decode the JWT">Decode</button>
    <button onclick="convertTimestampsToReadable()" title="Convert Unix timestamps in the JWT to readable format">Convert Timestamps</button>
    <button onclick="clearFields()" title="Clear all fields">Clear</button>
  </div>
  <h2>Decoded Token</h2>
  <h3>Header</h3>
  <pre id="headerEditor" contenteditable="true"></pre>
  <h3>Payload</h3>
  <pre id="payloadEditor" contenteditable="true"></pre>
  <button onclick="reencodeToken()" title="Reencode the JWT with the modified header and payload">Reencode</button>
  <h2>New JWT Token</h2>
  <textarea id="newJwtOutput" rows="3" readonly></textarea>
</body>
</html>